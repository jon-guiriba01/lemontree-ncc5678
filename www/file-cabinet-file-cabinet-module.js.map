{"version":3,"sources":["webpack:///./src/app/file-cabinet/file-cabinet.module.ts","webpack:///./src/app/file-cabinet/file-cabinet.page.html","webpack:///./src/app/file-cabinet/file-cabinet.page.scss","webpack:///./src/app/file-cabinet/file-cabinet.page.ts","webpack:///./src/app/services/storage.service.ts"],"names":[],"mappings":"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","file":"file-cabinet-file-cabinet-module.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { FileCabinetPage } from './file-cabinet.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: FileCabinetPage\n  }\n];\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    RouterModule.forChild(routes)\n  ],\n  declarations: [FileCabinetPage]\n})\nexport class FileCabinetPageModule {}\n","module.exports = \"<ion-content padding style='position: relative;'>\\n\\n\\t<ion-row>\\n\\t\\t<ion-item class='filter-row'>\\n\\t\\t\\t<img class='filter-icon' src='assets/imgs/settings_icon.png'/>\\n\\t\\t\\t<label>Filter</label>\\n\\n\\t\\t\\t<ion-select class='filter-select' value=\\\"showall\\\" (ionChange)='filterDownloadListByGroup()'>\\n\\t\\t\\t  <ion-select-option *ngFor='let group of groups' value=\\\"{{group}}\\\">{{group | uppercase}}</ion-select-option>\\n\\t\\t\\t</ion-select>\\n\\t\\t</ion-item>\\n\\t</ion-row>\\n\\n\\t<ion-list>\\n\\t\\t<div *ngFor=\\\"let file of storageService.files\\\">\\n\\t\\t\\t<ion-item *ngIf='file.name.toLowerCase().includes(searchService.searchInput.toLowerCase()) || searchService.searchInput == \\\"\\\"'>\\n\\t\\t\\t  <ion-label>{{file.name}}</ion-label>\\n\\t\\t\\t  <ion-button (click)='onClickDownload(file, $event)' class='download-btn'>\\n\\t\\t\\t  \\t<ion-icon name='download'></ion-icon>\\n\\t\\t\\t  </ion-button>\\n\\t\\t\\t  <ion-button (click)='onClickDelete(file, $event)' class='delete-btn'>\\n\\t\\t\\t  \\t<ion-icon name='close'></ion-icon>\\n\\t\\t\\t  </ion-button>\\n\\t\\t\\t</ion-item>\\n\\t\\t</div>\\n\\t</ion-list>\\n\\n\\n  <ion-fab-button size=\\\"small\\\" class=\\\"upload-fab\\\" (click)=\\\"upload()\\\">\\n  \\t<input type=\\\"file\\\" name=\\\"\\\" style='display: none;' class='hidden-input'/>\\n  \\t<ion-icon name=\\\"add\\\"></ion-icon>\\n  </ion-fab-button>\\n</ion-content>\\n\"","module.exports = \".upload-fab {\\n  position: fixed;\\n  right: 45px;\\n  bottom: 15px;\\n  --background: var(--ion-color-secondary); }\\n\\n.download-btn {\\n  --background: var(--green); }\\n\\n.delete-btn {\\n  --background: var(--red); }\\n\\n.filter-row {\\n  width: 100%;\\n  display: flex;\\n  justify-content: center;\\n  margin-bottom: 18px; }\\n\\n.filter-select {\\n  background: var(--blue);\\n  color: var(--ion-color-light);\\n  margin-left: 16px;\\n  min-width: 140px; }\\n\\n.filter-icon {\\n  width: 18px;\\n  height: 18px;\\n  margin-right: 8px; }\\n\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9hcHAvZmlsZS1jYWJpbmV0L0M6XFxVc2Vyc1xcSm9uXFxQcm9qZWN0c1xcRExTVS1OQ0MtNTY3OC1mcmVlbGFuY2Uvc3JjXFxhcHBcXGZpbGUtY2FiaW5ldFxcZmlsZS1jYWJpbmV0LnBhZ2Uuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLGVBQWU7RUFDZixXQUFXO0VBQ1gsWUFBWTtFQUNaLHdDQUFhLEVBQUE7O0FBSWY7RUFDQywwQkFBYSxFQUFBOztBQUdkO0VBQ0Msd0JBQWEsRUFBQTs7QUFHZDtFQUNDLFdBQVc7RUFDWCxhQUFhO0VBQ2IsdUJBQXVCO0VBQ3ZCLG1CQUFtQixFQUFBOztBQUlwQjtFQUNDLHVCQUF1QjtFQUN2Qiw2QkFBNkI7RUFDN0IsaUJBQWlCO0VBQ2pCLGdCQUFnQixFQUFBOztBQUdqQjtFQUNDLFdBQVc7RUFDWCxZQUFZO0VBQ1osaUJBQWlCLEVBQUEiLCJmaWxlIjoic3JjL2FwcC9maWxlLWNhYmluZXQvZmlsZS1jYWJpbmV0LnBhZ2Uuc2NzcyIsInNvdXJjZXNDb250ZW50IjpbIi51cGxvYWQtZmFie1xyXG4gIHBvc2l0aW9uOiBmaXhlZDtcclxuICByaWdodDogNDVweDtcclxuICBib3R0b206IDE1cHg7XHJcbiAgLS1iYWNrZ3JvdW5kOiB2YXIoLS1pb24tY29sb3Itc2Vjb25kYXJ5KTtcclxuXHJcbn1cclxuXHJcbi5kb3dubG9hZC1idG57XHJcblx0LS1iYWNrZ3JvdW5kOiB2YXIoLS1ncmVlbik7XHJcbn1cclxuXHJcbi5kZWxldGUtYnRue1xyXG5cdC0tYmFja2dyb3VuZDogdmFyKC0tcmVkKTtcclxufVxyXG5cclxuLmZpbHRlci1yb3d7XHJcblx0d2lkdGg6IDEwMCU7XHJcblx0ZGlzcGxheTogZmxleDtcclxuXHRqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcclxuXHRtYXJnaW4tYm90dG9tOiAxOHB4O1xyXG5cclxufVxyXG5cclxuLmZpbHRlci1zZWxlY3R7XHJcblx0YmFja2dyb3VuZDogdmFyKC0tYmx1ZSk7XHJcblx0Y29sb3I6IHZhcigtLWlvbi1jb2xvci1saWdodCk7XHJcblx0bWFyZ2luLWxlZnQ6IDE2cHg7XHJcblx0bWluLXdpZHRoOiAxNDBweDtcclxufVxyXG5cclxuLmZpbHRlci1pY29ue1xyXG5cdHdpZHRoOiAxOHB4O1xyXG5cdGhlaWdodDogMThweDtcclxuXHRtYXJnaW4tcmlnaHQ6IDhweDtcclxufSJdfQ== */\"","import { Component, OnInit } from '@angular/core';\ndeclare var gapi: any\nimport * as config from '../../config'\nimport { AuthService } from '../services/auth.service';\nimport { StorageService } from '../services/storage.service';\nimport { AngularFireStorage } from '@angular/fire/storage';\nimport * as $ from 'jquery'\nimport { SearchService } from '../services/search.service';\n\n\n\n@Component({\n  selector: 'app-file-cabinet',\n  templateUrl: './file-cabinet.page.html',\n  styleUrls: ['./file-cabinet.page.scss'],\n})\nexport class FileCabinetPage implements OnInit {\n\n  groups = [\n    'admin'\n    , 'operations'\n    , 'marketing'\n    , 'camps'\n    , 'showall'\n  ]\n  constructor(\n    public authService: AuthService\n    , public afStorage: AngularFireStorage\n    , public storageService: StorageService\n    , public searchService: SearchService\n  ) {\n    this.loadGapi().then((res)=>{\n        console.log(res);\n    })\n  }\n\n  files = [\n  ]\n  \n  ngOnInit() {\n  }\n\n  upload(){\n\n    $('.hidden-input').click()\n\n    $('.hidden-input').change((e:any)=>{\n        e.stopImmediatePropagation();\n        var file = e.target.files[0];\n        console.log('The file \"' + file.name +  '\" has been selected.');\n        this.storageService.uploadFile(file)\n    });\n\n  }\n\n\n  loadGapi(){\n    return new Promise((resolve,reject)=>{\n      gapi.load('client:auth2', _=> {\n\n        gapi.client.init({\n            'apiKey': config.google.apikey,\n            'clientId': config.google.webClientId,\n            'scope': 'https://www.googleapis.com/auth/drive',\n            'discoveryDocs': [\n              'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest',\n              'https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest'\n            ]\n        }).then(function () {\n            resolve(gapi)\n            let gAuth = gapi.auth2.getAuthInstance();\n              console.log('gAuth',gAuth)\n              console.log('gapi',gapi)\n\n              let test = gapi.client.drive.files.list()\n              console.log(\"test \", test)\n            // Listen for sign-in state changes.\n            gAuth.isSignedIn.listen((res)=>{\n              console.log('listen gapi',res)\n            });\n        });\n      })\n\n    })\n  }\n\n  onClickDownload(file, event){\n    this.storageService.downloadFile(file)\n  }\n\n\n  onClickDelete(file, event){\n    this.storageService.deleteFile(file)\n  }\n\n\n\n\n   // var fileMetadata = {\n    //   'name': 'photo.jpg'\n    // };\n    // var media = {\n    //   mimeType: 'image/jpeg',\n    //   body: fs.createReadStream('files/photo.jpg')\n    // };\n    // gapi.client.drive.files.create({\n    //   resource: fileMetadata,\n    //   media: media,\n    //   fields: 'id'\n    // }, function (err, file) {\n    //   if (err) {\n    //     // Handle error\n    //     console.error(err);\n    //   } else {\n    //     console.log('File Id: ', file.id);\n    //   }\n    // });\n\n\n    // var docId = '...';\n    // var content = 'Hello World';\n    // var contentBlob = new  Blob([content], {\n    //   'type': 'text/plain'\n    // });\n\n    // var xhr = new XMLHttpRequest();\n    // xhr.responseType = 'json';\n    // let accessToken = this.authService.user.credential.accessToken;\n    // console.log(\"using token \", accessToken)\n    // console.log(\"from \", this.authService.user)\n    // xhr.onreadystatechange = function() {\n    //   if (xhr.readyState != XMLHttpRequest.DONE) {\n    //     return;\n    //   }\n    //   console.log(xhr.response);\n    // };\n    // xhr.open('POST', 'https://www.googleapis.com/upload/drive/v3/files/?uploadType=media');\n    // // xhr.open('POST', 'https://www.googleapis.com/upload/drive/v3/files/' + fileId + '?uploadType=media');\n    // xhr.setRequestHeader('Authorization', 'Bearer ' + accessToken);\n    // xhr.send(contentBlob);\n\n}\n","import { Injectable } from '@angular/core';\nimport { AngularFireStorage } from '@angular/fire/storage';\nimport { AngularFirestore } from '@angular/fire/firestore';\nimport { finalize } from 'rxjs/operators';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StorageService {\n\n\tfiles=[]\n  filesCollection\n  constructor(\n  \tprivate afStorage: AngularFireStorage\n    , private afs: AngularFirestore\n  ) {\n  \tthis.filesCollection = this.afs.collection('files')\n    this.filesCollection.snapshotChanges().subscribe(\n      (dataSet)=>{\n        let files = []\n        for(let data of dataSet){\n          let task = {...data.payload.doc.data()}\n          task.id = data.payload.doc.id\n\n          files.push(task)\n        }\n\n        this.files = files\n        console.log(\"this.files\", this.files)\n      }\n    )\n  }\n\n  uploadFile(file, path = 'filecabinet'){\n    console.log('[uploadFile]', file)\n    console.log('-path', path)\n    let fullPath = `${path}/${file.name}`;\n    const fileRef = this.afStorage.ref(fullPath);\n    const uploadTask = this.afStorage.upload(fullPath,file);\n\n    let afUploadTask = uploadTask.percentageChanges()\n\n    uploadTask.snapshotChanges().pipe(\n        finalize(async () => {\n          console.log('-finalize', path)\n          fileRef.getDownloadURL().subscribe((downloadURL)=>{\n            this.filesCollection.add({\n            name:file.name\n            , path: fullPath\n            , downloadURL: downloadURL\n            })\n          })\n      \n        } )\n     )\n    .subscribe((res)=>{\n      console.log('afUploadTask', res)\n\n    })\n  }\n\n  downloadFile(file){\n    console.log('[downloadFile]', file)\n    \n    var tempLink = document.createElement('a');\n    tempLink.href = file.downloadURL;\n    tempLink.setAttribute('download', name);\n    tempLink.click();\n  }\n\n  deleteFile(file){\n  \tconsole.log('[deleteFile]', file)\n  }\n\n}\n"],"sourceRoot":""}